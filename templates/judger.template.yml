params:
  version: latest

  home: /var/judger

run:
  - exec:
      hook: code
      cmd:
        - /usr/bin/curl -s https://api.github.com/repos/DHUers/RigidJudge/releases/$version | /bin/grep browser_download_url | /usr/bin/head -n 1 | /usr/bin/cut -d '"' -f 4 | /usr/bin/wget -i - -O RigidJudge.tar
        - /bin/tar -xf RigidJudge.tar -C /tmp
        - mv /tmp/RigidJudge $home
        - chown -R rigidjudge /var/judger
        - chgrp -R rigidjudge /var/judger
        # - make -C /var/RigidJudge/bin/sandbox/ all
  - file:
     path: /etc/runit/3.d/10-judger
     chmod: "+x"
     contents: |
       #!/bin/bash
       cd /var/judger/bin
       ./RigidJudge

  - exec:
      hook: build
      cmd:
        - echo 'build'
